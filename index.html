<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="utf-8" />
    <title>Via-Sacra Digital - Viso</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { 
            --roxo: #6A0DAD; 
            --dourado: #FFD700; 
            --fundo: #ffffff;
            --glass: rgba(255, 255, 255, 0.85);
        }
        
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; overflow: hidden; }
        #map { height: 100vh; width: 100vw; background: #242424; }

        /* Painel Superior Estilo App */
        .progress-panel {
            position: absolute; top: 15px; left: 15px;
            width: calc(100% - 90px); /* D√° espa√ßo exato para o bot√£o no canto */
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 12px 15px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            z-index: 1000;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .dist-info { font-size: 16px; font-weight: 800; color: #333; letter-spacing: -0.5px; }
        .sub-info { font-size: 11px; color: #666; text-transform: uppercase; font-weight: 600; margin-top: 2px; }

        /* √çcones das Esta√ß√µes - Mais Brilhantes */
        .number-icon {
            background: var(--roxo); 
            border: 3px solid var(--dourado); 
            border-radius: 50%;
            color: white; font-weight: bold; text-align: center;
            line-height: 26px; font-size: 14px;
            box-shadow: 0 0 15px rgba(106, 13, 173, 0.5);
        }

        /* Bot√£o GPS - Estilo Flutuante */
        .btn-start {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            z-index: 1000; padding: 16px 40px; 
            background: linear-gradient(135deg, var(--roxo), #4B0082);
            color: white; border: none; border-radius: 30px;
            font-weight: bold; font-size: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            cursor: pointer; transition: all 0.3s;
        }

        /* Estilo do Seletor de Mapas (Bot√£o Redondo) */
        .leaflet-control-layers {
            border: none !important;
            border-radius: 12px !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2) !important;
        }

        /* Estilo Dark para o Popup */
        .dark-popup .leaflet-popup-content-wrapper {
            background: #1a1a1a; color: #eee; border: 1px solid var(--roxo);
        }
        .dark-popup .leaflet-popup-tip { background: #1a1a1a; }
        .dark-popup h3 { color: var(--dourado) !important; border-bottom: 1px solid #444 !important; }
    </style>
</head>
<body>

    <div class="progress-panel" id="mainPanel">
        <div class="dist-info">Via-Sacra do Viso</div>
        <div class="sub-info">Senhora do Porto ‚ûî Viso</div>
    </div>

    <button class="btn-start" id="startBtn" onclick="ativarGPS()">COME√áAR CAMINHADA</button>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. MAPAS COM MAIS DETALHE
        // Mapa Dia: OpenStreetMap Standard
        var mapaDia = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 20,
            attribution: '¬© OSM'
        });

        // Mapa Noite: Stadia Alidade Smooth Dark (Muito melhor que o anterior)
        var mapaNoite = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
            maxZoom: 20,
            attribution: '¬© Stadia Maps'
        });

        var map = L.map('map', { 
            zoomControl: false, 
            attributionControl: false,
            layers: [mapaDia] 
        }).setView([41.17558, -8.63293], 18);

        var baseMaps = { "‚òÄÔ∏è Dia": mapaDia, "üåô Noite": mapaNoite };
        var layersControl = L.control.layers(baseMaps, null, { position: 'topright', collapsed: true }).addTo(map);

        // Mudar o tema visual conforme o mapa escolhido
        map.on('baselayerchange', function(e) {
            var panel = document.getElementById('mainPanel');
            if (e.name === "üåô Noite") {
                panel.style.background = "rgba(0, 0, 0, 0.8)";
                panel.style.color = "white";
                document.querySelector('.dist-info').style.color = "white";
                document.querySelector('.sub-info').style.color = "#aaa";
            } else {
                panel.style.background = "rgba(255, 255, 255, 0.85)";
                panel.style.color = "black";
                document.querySelector('.dist-info').style.color = "#333";
                document.querySelector('.sub-info').style.color = "#666";
            }
        });

        var userMarker;

        fetch('rota.geojson?v=' + Date.now())
            .then(r => r.json())
            .then(data => {
                L.geoJSON(data, {
                    style: function(feature) {
                        return { color: '#FFD700', weight: 5, opacity: 0.8, dashArray: '1, 10', lineCap: 'round' };
                    },
                    pointToLayer: function(f, latlng) {
                        var num = f.properties.nome.match(/\d+/)[0];
                        var icon = L.divIcon({ 
                            className: 'number-icon', 
                            html: num, 
                            iconSize: [32, 32], 
                            iconAnchor: [16, 16] 
                        });
                        
                        var popupClass = map.hasLayer(mapaNoite) ? 'dark-popup' : '';
                        return L.marker(latlng, { icon: icon }).bindPopup(
                            `<div class="station-content">${f.properties.texto}</div>`, 
                            { maxWidth: 280, className: popupClass }
                        );
                    }
                }).addTo(map);
            });

        function ativarGPS() {
            document.getElementById('startBtn').style.opacity = '0';
            setTimeout(() => document.getElementById('startBtn').style.display = 'none', 300);
            map.locate({ setView: true, watch: true, enableHighAccuracy: true, maxZoom: 19 });
        }

        map.on('locationfound', function(e) {
            if (!userMarker) {
                userMarker = L.circleMarker(e.latlng, { 
                    radius: 10, color: 'white', fillColor: '#007AFF', fillOpacity: 1, weight: 3 
                }).addTo(map);
            } else { 
                userMarker.setLatLng(e.latlng); 
            }
        });

        map.on('locationerror', function() { alert("Por favor, ative o GPS."); });
    </script>
</body>
</html>
